{"version":3,"sources":["../../src/configurators/dll.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;2CAEO,WAA4B,YAA5B,EAA6D;AAClE,QAAI,WAAW,GAAkB,IAAjC;AACA,UAAM,UAAU,GAAG,YAAY,CAAC,UAAhC;;AAEA,QAAI,YAAY,CAAC,IAAb,KAAsB,cAA1B,EAA0C;AACxC,YAAM,GAAG,GAAG,YAAY,CAAC,4BAAb,CAA0C,QAA1C,CAAqD,GAAjE;;AACA,UAAI,GAAG,IAAI,IAAX,EAAiB;AACf,cAAM,IAAI,KAAJ,CAAU,yCAAV,CAAN;AACD;;AAED,MAAA,YAAY,CAAC,MAAb,CAAoB,KAApB,GAA4B,KAAK,CAAC,OAAN,CAAc,GAAd,IAAqB;AAAC,QAAA,MAAM,EAAE;AAAT,OAArB,GAAqC,GAAjE;AAEA,MAAA,WAAW,GAAG,IAAI,CAAC,IAAL,CAAU,YAAY,CAAC,mBAAvB,EAA4C,YAAY,CAAC,IAAzD,EAA+D,eAA/D,CAAd;AACA,MAAA,YAAY,CAAC,OAAb,CAAqB,IAArB,CAA0B,KAAI,oBAAJ,EAAc;AACtC,QAAA,IAAI,EAAE,QADgC;AAEtC,QAAA,IAAI,EAAE,WAFgC;AAGtC,QAAA,OAAO,EAAE;AAH6B,OAAd,CAA1B;AAMA,YAAM,MAAM,GAAG,YAAY,CAAC,MAAb,CAAoB,MAAnC,CAfwC,CAgBxC;;AACA,aAAO,MAAM,CAAC,aAAd;AACA,MAAA,MAAM,CAAC,OAAP,GAAiB,QAAjB;AACD,KAnBD,MAoBK,IAAI,YAAY,CAAC,IAAb,KAAsB,UAA1B,EAAsC;AACzC,YAAM,MAAM,GAAG,IAAI,CAAC,IAAL,CAAU,YAAY,CAAC,mBAAvB,EAA4C,cAA5C,CAAf;AACA,YAAM,OAAO,GAAG,MAAM,wBAAW,MAAX,CAAtB;;AACA,UAAI,OAAO,IAAI,IAAX,IAAmB,CAAC,OAAO,CAAC,WAAR,EAAxB,EAA+C;AAC7C,QAAA,YAAY,CAAC,KAAb,CAAmB,kBAAnB;AACA,eAAO,IAAP;AACD;;AAED,MAAA,YAAY,CAAC,KAAb,CAAmB,kBAAkB,MAAM,EAA3C;AACA,MAAA,YAAY,CAAC,OAAb,CAAqB,IAArB,CAA0B,KAAI,6BAAJ,EAAuB;AAC/C,QAAA,OAAO,EAAE,UADsC;AAE/C,QAAA,QAAQ,EAAE,MAAM,0BAAS,IAAI,CAAC,IAAL,CAAU,MAAV,EAAkB,eAAlB,CAAT;AAF+B,OAAvB,CAA1B;AAID;;AAED,WAAO,WAAP;AACD,G;;kBAxCqB,Y;;;;;;;;4CA0Cf,WAA4B,MAA5B,EAA4C,YAA5C,EAA6E;AAClF,QAAI,YAAY,CAAC,4BAAb,CAA0C,QAA1C,CAAqD,GAArD,IAA4D,IAAhE,EAAsE;AACpE,aAAO,EAAP;AACD;;AAED,UAAM,KAAK,GAAG,MAAM,kCAAqB,yBAAQ,MAAR,CAArB,CAApB;AACA,WAAO,KAAK,IAAI,IAAT,GAAgB,EAAhB,GAAqB,KAAK,CAAC,MAAN,CAAa,EAAE,IAAI,EAAE,CAAC,QAAH,CAAY,KAAZ,KAAsB,EAAE,CAAC,QAAH,CAAY,MAAZ,CAAzC,EAA8D,IAA9D,EAA5B;AACD,G;;kBAPqB,Y","sourcesContent":["import { readdir, readJson } from \"fs-extra-p\"\nimport * as path from \"path\"\nimport { DllPlugin, DllReferencePlugin } from \"webpack\"\nimport { WebpackConfigurator } from \"../main\"\nimport { orNullIfFileNotExist, statOrNull } from \"../util\"\n\nexport async function configureDll(configurator: WebpackConfigurator): Promise<string | null> {\n  let dllManifest: string | null = null\n  const projectDir = configurator.projectDir\n\n  if (configurator.type === \"renderer-dll\") {\n    const dll = configurator.electronWebpackConfiguration.renderer!!.dll\n    if (dll == null) {\n      throw new Error(`renderer-dll requires DLL configuration`)\n    }\n\n    configurator.config.entry = Array.isArray(dll) ? {vendor: dll} : dll\n\n    dllManifest = path.join(configurator.commonDistDirectory, configurator.type, \"manifest.json\")\n    configurator.plugins.push(new DllPlugin({\n      name: \"[name]\",\n      path: dllManifest,\n      context: projectDir,\n    }))\n\n    const output = configurator.config.output!\n    // leave as default \"var\"\n    delete output.libraryTarget\n    output.library = \"[name]\"\n  }\n  else if (configurator.type === \"renderer\") {\n    const dllDir = path.join(configurator.commonDistDirectory, \"renderer-dll\")\n    const dirStat = await statOrNull(dllDir)\n    if (dirStat == null || !dirStat.isDirectory()) {\n      configurator.debug(\"No DLL directory\")\n      return null\n    }\n\n    configurator.debug(`DLL directory: ${dllDir}`)\n    configurator.plugins.push(new DllReferencePlugin({\n      context: projectDir,\n      manifest: await readJson(path.join(dllDir, \"manifest.json\")),\n    }))\n  }\n\n  return dllManifest\n}\n\nexport async function getDllAssets(dllDir: string, configurator: WebpackConfigurator) {\n  if (configurator.electronWebpackConfiguration.renderer!!.dll == null) {\n    return []\n  }\n\n  const files = await orNullIfFileNotExist(readdir(dllDir))\n  return files == null ? [] : files.filter(it => it.endsWith(\".js\") || it.endsWith(\".css\")).sort()\n}"],"sourceRoot":""}
